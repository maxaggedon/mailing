import Link from "next/link";

# REST API

With the REST API, you can use mailing for email templating even if most of your app is not written in TypeScript or JavaScript.

## Send and Render Emails

| Method    | Path                           | Description                          |                                                                                                      Example |
| --------- | ------------------------------ | ------------------------------------ | -----------------------------------------------------------------------------------------------------------: |
| GET, POST | [/api/render](#api-render)     | render a template with props to HTML | [Link](https://demo.mailing.run/api/render?templateName=AccountCreated&props=%7B%22name%22%3A%22peter%22%7D) |
| POST      | [/api/sendMail](#api-sendmail) | send an email                        |                                                                                                              |

## Previews

| Method | Path                                           | Description                  |                                                                     Example |
| ------ | ---------------------------------------------- | ---------------------------- | --------------------------------------------------------------------------: |
| GET    | /api/previews                                  | returns the list of previews |                               [Link](https://demo.mailing.run/api/previews) |
| GET    | /api/previews/[previewClass]/[previewFunction] | returns the rendered preview | [Link](https://demo.mailing.run/api/previews/AccountCreated/accountCreated) |

## Lists/Members [Platform]

| Method | Path                                   | Description                   |
| ------ | -------------------------------------- | ----------------------------- |
| GET    | /api/lists                             | get all lists                 |
| POST   | /api/lists                             | create a new list             |
| GET    | /api/lists/[listId]/members            | get the members of a list     |
| POST   | /api/lists/[listId]/members            | add a member to a list        |
| GET    | /api/lists/[listId]/members/[memberId] | get a list member's status    |
| PATCH  | /api/lists/[listId]/members/[memberId] | update a list member's status |

## API keys

Mailing uses API keys to protect endpoints that consume limited resources (e.g. sending email with your transport).

To get an API key, either [set up a database](https://www.mailing.run/docs/deploy#adding-a-database) and log in (recommended).

Or, make up your own key and assign it to the `MAILING_API_KEY` environment variable in your deployment environment.

You then pass your API key in each request with one of these methods:

- Include the API key in the request headers: `X-API-KEY=...`
- Include the API key as a query string parameter: `?apiKey=...`

## API endpoints

All API endpoints expect the body to be a JSON string and the header Content-Type to be "application/json".

### /api/render<a id="api-render" />

Render a template with props to HTML.

**Authentication optional**

/api/render is publicly accessible by default. However, if `process.env.REQUIRE_API_KEY` is set, then api/render will return 401 unless a valid [API key](#api-keys)
is included in the request.

**Request parameters**

- templateName: string (required if using template mode, must be the name of one of your templates)
- props: []string (required if using template mode, must correspond to the props your template expects)

**Success response**

**Error responses**

### /api/sendMail<a id="api-sendmail" />

Send an email using your configured sendmail.

**Authentication required**

Authentication by [API key](#api-keys) is required.

**Request parameters**

You can either use /api/sendMail to send raw html or a template.

- templateName: string (required if using template mode, must be the name of one of your templates)
- props: []string (required if using template mode, must correspond to the props your template expects)
- [Standard nodemailer options](#standard-nodemailer-options)
- html: string (required if using raw html mode)
- previewName: string (optional) - used for analytics only, gets put on the Message object in the database so you can tell what preview was used to send the email

Example request (template mode):

```
POST /api/sendMail
Content-Type: application/json
X-API-KEY: your-api-key

{
  "to": "to@example.com",
  "from": "you@example.com",
  "subject": "Hello world",
  "templateName": "myTemplate",
  "props": {
    "name": "Alex"
  },
}
```

Example request (raw html mode):

```
POST /api/sendMail
Content-Type: application/json
X-API-KEY: your-api-key

{
  "to": "to@example.com",
  "from": "you@example.com",
  "subject": "Hello world",
  "html": "<html><body>Hello World</body></html>",
  "text": "Hello world",
}
```

**Success response**

HTTP Status Code 200
Response body: JSON object with possible attributes

- result: [SMTPPool.SentMessageInfo](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/6f93d358c4eb1d30bf0da65606c27c58a1a0979a/types/nodemailer/lib/smtp-pool/index.d.ts#L35) the return value from sendMail

**Error responses**
HTTP Status Code: 401 or 422 or 500

401 indicates an invalid API key

422 indicates an invalid request

Response body: JSON object with possible attributes

- error: string - error message
- mjmlErrors: []string - MJML errors thrown during template rendering

500 indicates an internal server error

- error: string - error message

Example error response:

```
422 Unprocessable Entity
Content-Type: application/json

{
  "error": "sendMail couldn't find a subject for your email"
}
```

## Standard nodemailer options

The full list of options that nodemailer supports, e.g. to, from, cc, bcc, subject, etc.

See the full list in the [nodemailer typescript interface](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/cf2eda338072c0b685d4e8a2c3dc928eb6ee1070/types/nodemailer/lib/mailer/index.d.ts#L96)
